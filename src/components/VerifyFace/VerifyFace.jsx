import React , { useState, useEffect } from 'react';
import { makeStyles } from '@material-ui/core/styles';
import Container from '@material-ui/core/Container';
import Typography from '@material-ui/core/Typography';
import Grid from '@material-ui/core/Grid';
import CardContent from '@material-ui/core/CardContent';
import Card from '@material-ui/core/Card';
import CardMedia from '@material-ui/core/CardMedia';
import {getFaceMatcher} from '../../utilities/faceMaster';
import {verifyLogin}  from '../../utilities/faceMaster';



const useStyles = makeStyles(theme => ({
    cardGrid: {
        //paddingTop: theme.spacing(3),
        paddingBottom: theme.spacing(6),
     
        
      },
      cardMedia: {
        padding: theme.spacing(2,0,2), 
        [theme.breakpoints.up('md')]: {
            padding: theme.spacing(4,0,4), 
        },
       //background: `#2980b9`, 
       //background: `-webkit-linear-gradient(to right, #2980b9, #2c3e50)`, 
       background: `linear-gradient(to right, #2980b9, #2c3e50)`, 


      },
      card: {
        //height: '100%',
        //display: 'flex',
        //flexDirection: 'column',
        padding: theme.spacing(0, 0, 3),
        marginTop: theme.spacing(3),
        [theme.breakpoints.up('md')]: {
            marginTop: theme.spacing(6),
        } 
      },
      hide: {
        display: 'none',
        overflow: 'hidden'
      },

      cardAction: {
        marginTop: theme.spacing(4),
        [theme.breakpoints.up('md')]: {
          marginTop: theme.spacing(6),
      } 
    },
}));

const VerifyFace = (props) => {

    const classes = useStyles();
    const [userName, setUserName] = React.useState("");

    useEffect(() => {
     
      let videoPlayer = document.querySelector('#player');
      let canvasElement = document.querySelector('#canvas');
  
      setTimeout(
        async () => {
         let userFacesData = JSON.parse(localStorage.getItem("userFacesData")) || [];
         let faceUserName = userFacesData[0].user;
         setUserName(faceUserName);
         await getFaceMatcher(userFacesData);
         
         await verifyLogin(videoPlayer,canvasElement,faceUserName);
  
  
      },800);
  

    });




  return (


    <Container className={classes.cardGrid} maxWidth="md">
    <Grid container spacing={4}>
        <Grid item xs={12} sm={12} md={12}>
         <Card className={classes.card}>
             <CardMedia
             className={classes.cardMedia}
             title="Face Auth"
             > 
             <Typography component="h2" variant="h4" align="center" color="secondary" gutterBottom>
                 AMEX Face Shield
             </Typography>
             <Typography variant="subtitle1" component="h2" align="center" color="secondary" gutterBottom>
                     AUTHENTICATE WITH YOUR FACE
                 </Typography>
             </CardMedia>
             <CardContent className={classes.cardContent}>
               <div>
                 <Typography component="h5" variant="h5" align="center"  gutterBottom>
                            Feel Secured !
                  </Typography>
                    <Typography variant="body1" component="h2" align="center" gutterBottom>
                               LOOK IN THE CAMERA AND BE STILL FOR 2 SECS ! OF COURSE, YOU CAN SMILE :)
                    </Typography>
                
                </div>
               <Grid container id="playerDiv" className={`${classes.cardAction}`}  allow="geolocation; camera ; microphone">
                
                <Grid item xs={12} sm={4} md={4}> <video id="player" autoPlay width="320" height="247"  allow="autoplay; geolocation; camera ; microphone"></video> </Grid>
                <Grid item xs={12} sm={4} md={4}> <canvas id="canvas" width="320" height="247" className={classes.hide}  allow="geolocation; camera ; microphone"></canvas> </Grid>
                <Grid item xs={12} sm={4} md={4}> 
                  <div className="face-id-wrapper">
                    <svg className="face-id-default" enableBackground="new 0 0 91 91" height="91px" id="Layer_1" version="1.1" viewBox="0 0 91 91" width="91px">
                      <g>
                        <path d="M53.561,66.82c-6.977,1.621-15.125,0.238-15.207,0.225c-1.371-0.238-2.668,0.678-2.906,2.043      c-0.238,1.367,0.674,2.668,2.041,2.906c0.23,0.041,3.746,0.643,8.297,0.643c2.757,0,5.896-0.221,8.914-0.922      c1.352-0.314,2.192-1.666,1.879-3.018S54.912,66.504,53.561,66.82z"/>
                        <path d="M81.23,37.238c-0.004-0.332,0.002-0.662,0.008-0.99c0.01-0.6,0.018-1.199-0.012-1.801      c-0.281-5.872-2.088-11.524-5.373-16.801C72.736,12.634,68.6,8.535,63.561,5.46c-5.156-3.146-10.758-4.838-16.649-5.029      c-5.744-0.189-11.285,1.043-16.453,3.656c-6.607,3.344-11.824,8.342-15.504,14.854c-2.902,5.145-4.432,10.541-4.551,16.04      c-0.082,3.902,0.088,7.844,0.506,11.717c0.723,6.692,2.018,12.549,3.963,17.897c3.328,9.148,9.785,15.926,14.615,20.002      c4.035,3.406,7.309,5.098,12.693,5.98c1.221,0.199,2.359,0.297,3.479,0.297c4.856,0,8.603-1.18,11.925-3.311      c8.402-5.381,14.986-13.229,18.541-22.092C79.543,56.947,81.213,47.723,81.23,37.238z M54.873,83.334      c-4.834,3.098-7.609,2.982-11.88,2.285c-4.133-0.678-6.635-1.797-10.266-4.861c-4.363-3.682-10.184-9.773-13.133-17.879      c-1.805-4.965-3.012-10.434-3.689-16.721c-0.395-3.66-0.555-7.385-0.479-11.07c0.102-4.663,1.414-9.264,3.902-13.676      c3.184-5.633,7.691-9.953,13.396-12.842c4.111-2.078,8.496-3.133,13.035-3.133c0.328,0,0.656,0.006,0.988,0.016      c5.012,0.164,9.789,1.609,14.194,4.299c4.363,2.66,7.943,6.209,10.646,10.549c2.826,4.541,4.381,9.383,4.619,14.389      c0.024,0.494,0.017,0.984,0.008,1.475c-0.008,0.375-0.014,0.752-0.01,1.098c-0.017,9.803-1.567,18.418-4.744,26.34 C68.293,71.504,62.402,78.512,54.873,83.334z"/>
                        <path d="M42.311,62.016c0.455,0.844,1.32,1.32,2.213,1.32c0.404,0,0.813-0.096,1.191-0.301c2.623-1.416,4.889-2.807,4.984-2.865      c1.182-0.729,1.549-2.275,0.822-3.457c-0.729-1.182-2.275-1.549-3.457-0.822c-0.021,0.014-2.236,1.373-4.734,2.724 C42.108,59.271,41.653,60.795,42.311,62.016z"/>
                        <path d="M41.139,44.154c0.672,0,1.344-0.27,1.838-0.801c0.947-1.014,0.891-2.604-0.125-3.551      c-7.838-7.307-17.375-4.771-21.322-2.412c-1.191,0.713-1.578,2.256-0.867,3.447c0.713,1.189,2.256,1.576,3.447,0.865      c0.08-0.049,8.25-4.809,15.316,1.775C39.911,43.93,40.526,44.154,41.139,44.154z"/>
                        <path d="M69.711,37.311c-0.369-0.188-9.098-4.557-16.709-0.723c-6.434,3.236-6.973,10.004-6.816,14.814      c0.043,1.358,1.158,2.432,2.508,2.432c0.027,0,0.058-0.002,0.084-0.002c1.388-0.045,2.476-1.205,2.431-2.592      c-0.185-5.678,0.992-8.623,4.054-10.164c5.319-2.678,12.102,0.676,12.17,0.711c1.233,0.631,2.743,0.137,3.375-1.096 C71.436,39.455,70.945,37.941,69.711,37.311z"/>
                        <path d="M2.84,18.222c1.389,0,2.514-1.125,2.514-2.514V5.437h10.27c1.389,0,2.514-1.125,2.514-2.514      c0-1.387-1.125-2.512-2.514-2.512H2.84c-1.387,0-2.512,1.125-2.512,2.512v12.785C0.329,17.097,1.454,18.222,2.84,18.222z"/>
                        <path d="M88.334,0.412H75.551c-1.389,0-2.514,1.125-2.514,2.512c0,1.389,1.125,2.514,2.514,2.514h10.27v10.271      c0,1.389,1.125,2.514,2.515,2.514c1.388,0,2.513-1.125,2.513-2.514V2.923C90.846,1.537,89.721,0.412,88.334,0.412z"/>
                        <path d="M15.624,85.768H5.354V75.496c0-1.389-1.125-2.514-2.514-2.514c-1.387,0-2.512,1.125-2.512,2.514v12.785      c0,1.387,1.125,2.512,2.512,2.512h12.783c1.389,0,2.514-1.125,2.514-2.512C18.137,86.893,17.012,85.768,15.624,85.768z"/>
                        <path d="M88.334,72.982c-1.389,0-2.514,1.125-2.514,2.514v10.271H75.55c-1.389,0-2.514,1.125-2.514,2.514      c0,1.387,1.125,2.512,2.514,2.512h12.783c1.388,0,2.513-1.125,2.513-2.512V75.496C90.846,74.107,89.721,72.982,88.334,72.982z"/>
                      </g>
                    </svg>
                    <svg className="face-id-checked" enableBackground="new 0 0 91 91" height="91px" id="Layer_1" version="1.1" viewBox="0 0 91 91" width="91px">
                      <g>
                        <path d="M2.669,18.273c1.388,0,2.513-1.125,2.513-2.513V5.488h10.271c1.388,0,2.513-1.125,2.513-2.513s-1.125-2.513-2.513-2.513   H2.669c-1.388,0-2.513,1.125-2.513,2.513V15.76C0.156,17.148,1.281,18.273,2.669,18.273z"/>
                        <path d="M88.163,0.462H75.38c-1.389,0-2.514,1.125-2.514,2.513s1.125,2.513,2.514,2.513h10.27V15.76   c0,1.388,1.125,2.513,2.514,2.513c1.387,0,2.512-1.125,2.512-2.513V2.975C90.675,1.587,89.55,0.462,88.163,0.462z"/>
                        <path d="M15.452,85.818H5.182V75.547c0-1.388-1.125-2.513-2.513-2.513s-2.513,1.125-2.513,2.513v12.784   c0,1.388,1.125,2.513,2.513,2.513h12.783c1.388,0,2.513-1.125,2.513-2.513S16.84,85.818,15.452,85.818z"/>
                        <path d="M88.163,73.034c-1.389,0-2.514,1.125-2.514,2.513v10.271H75.38c-1.389,0-2.514,1.125-2.514,2.513s1.125,2.513,2.514,2.513   h12.783c1.387,0,2.512-1.125,2.512-2.513V75.547C90.675,74.159,89.55,73.034,88.163,73.034z"/>
                        <path d="M64.739,27.448c-1.023-0.935-2.613-0.862-3.549,0.163l-21.336,23.39l-5.68-6.096c-0.943-1.014-2.534-1.07-3.551-0.125   c-1.015,0.946-1.071,2.536-0.125,3.551l7.537,8.09c0.475,0.51,1.141,0.8,1.838,0.8c0.004,0,0.009,0,0.014,0   c0.701-0.004,1.369-0.301,1.843-0.819l23.173-25.404C65.837,29.972,65.765,28.383,64.739,27.448z"/>
                        <path d="M67.331,85.843c-1.951-0.275-3.305-1.038-4.139-2.331c-1.803-2.799-0.963-7.625-0.486-9.252   c0.002-0.005,0.002-0.009,0.004-0.014c4.549-4.255,8.139-9.403,10.385-15.005c3.082-7.684,4.588-16,4.604-25.457   c-0.004-0.298,0.002-0.596,0.006-0.894c0.01-0.539,0.018-1.078-0.01-1.619c-0.254-5.314-1.891-10.433-4.863-15.213   c-2.822-4.534-6.566-8.243-11.125-11.024c-4.67-2.848-9.742-4.38-15.076-4.554c-5.207-0.166-10.223,0.944-14.902,3.31   c-5.979,3.028-10.699,7.551-14.03,13.444c-2.625,4.655-4.011,9.542-4.118,14.523c-0.074,3.522,0.079,7.073,0.456,10.552   c0.649,6.027,1.818,11.305,3.574,16.135c2.521,6.927,7.02,12.341,10.978,16.081c0.292,1.172,1.34,6.027-0.551,8.975   c-0.833,1.3-2.189,2.066-4.145,2.342c-1.374,0.194-2.331,1.466-2.137,2.84c0.177,1.255,1.252,2.161,2.485,2.161   c0.117,0,0.235-0.008,0.354-0.024c3.395-0.479,6.048-2.072,7.672-4.605c1.406-2.192,1.858-4.749,1.898-7.045   c2.379,1.704,4.821,2.938,8.167,3.484c1.11,0.182,2.146,0.271,3.166,0.271c4.43,0,7.832-1.789,10.848-3.723   c0.24-0.153,0.473-0.314,0.707-0.473c-0.012,2.404,0.408,5.151,1.904,7.485c1.625,2.533,4.277,4.126,7.672,4.605   c0.119,0.017,0.238,0.024,0.355,0.024c1.232,0,2.307-0.906,2.484-2.161C69.661,87.309,68.706,86.037,67.331,85.843z M53.634,74.971   c-4.283,2.745-6.717,3.342-10.491,2.724c-3.719-0.607-5.877-2.303-9.093-5.019c-3.895-3.286-9.088-8.721-11.719-15.948   c-1.615-4.443-2.695-9.336-3.3-14.956c-0.354-3.267-0.498-6.601-0.428-9.906c0.09-4.144,1.258-8.236,3.471-12.16   c2.833-5.013,6.844-8.859,11.922-11.431c3.655-1.849,7.557-2.786,11.594-2.786c0.291,0,0.582,0.005,0.875,0.015   c4.457,0.145,8.703,1.43,12.623,3.821c3.885,2.369,7.072,5.528,9.475,9.389c2.516,4.043,3.9,8.349,4.111,12.798   c0.021,0.434,0.014,0.865,0.006,1.296c-0.006,0.345-0.012,0.69-0.008,1.002c-0.014,8.772-1.402,16.48-4.242,23.562   C65.606,64.415,60.351,70.666,53.634,74.971z"/>
                      </g>
                    </svg>
                    <svg className="face-id-error" enableBackground="new 0 0 91 91" height="91px" id="Layer_1" version="1.1" viewBox="0 0 91 91" width="91px">
                      <g>
                        <path d="M2.682,18.273c1.387,0,2.512-1.125,2.512-2.513V5.488h10.271c1.387,0,2.512-1.125,2.512-2.513s-1.125-2.513-2.512-2.513   H2.682c-1.389,0-2.514,1.125-2.514,2.513V15.76C0.168,17.148,1.293,18.273,2.682,18.273z"/>
                        <path d="M88.174,0.462H75.391c-1.387,0-2.512,1.125-2.512,2.513s1.125,2.513,2.512,2.513h10.271V15.76   c0,1.388,1.125,2.513,2.512,2.513c1.389,0,2.514-1.125,2.514-2.513V2.975C90.688,1.587,89.563,0.462,88.174,0.462z"/>
                        <path d="M15.465,85.818H5.193V75.547c0-1.388-1.125-2.513-2.512-2.513c-1.389,0-2.514,1.125-2.514,2.513v12.784   c0,1.388,1.125,2.513,2.514,2.513h12.783c1.387,0,2.512-1.125,2.512-2.513S16.852,85.818,15.465,85.818z"/>
                        <path d="M88.174,73.034c-1.387,0-2.512,1.125-2.512,2.513v10.271H75.391c-1.387,0-2.512,1.125-2.512,2.513s1.125,2.513,2.512,2.513   h12.783c1.389,0,2.514-1.125,2.514-2.513V75.547C90.688,74.159,89.563,73.034,88.174,73.034z"/>
                        <path d="M67.344,85.843c-1.951-0.275-3.305-1.038-4.139-2.331c-1.805-2.799-0.963-7.625-0.486-9.252c0-0.005,0-0.009,0.002-0.014   c4.551-4.255,8.141-9.403,10.387-15.005c3.082-7.686,4.588-16.002,4.604-25.457c-0.004-0.298,0.002-0.595,0.006-0.892   c0.01-0.54,0.016-1.079-0.01-1.621c-0.254-5.314-1.891-10.433-4.865-15.213c-2.82-4.534-6.564-8.243-11.123-11.024   c-4.67-2.848-9.742-4.38-15.076-4.554c-5.211-0.168-10.225,0.945-14.902,3.31c-5.98,3.028-10.699,7.55-14.029,13.444   c-2.627,4.656-4.012,9.542-4.119,14.523c-0.074,3.521,0.078,7.072,0.455,10.553c0.648,6.025,1.818,11.303,3.574,16.135   c2.521,6.929,7.021,12.344,10.98,16.084c0.48,1.835,1.156,6.321-0.559,8.981c-0.834,1.294-2.188,2.057-4.141,2.332   c-1.373,0.194-2.33,1.466-2.137,2.84c0.178,1.255,1.254,2.161,2.486,2.161c0.115,0,0.234-0.008,0.354-0.024   c3.395-0.479,6.049-2.072,7.674-4.605c1.406-2.192,1.857-4.749,1.898-7.045c2.377,1.704,4.82,2.938,8.166,3.484   c1.111,0.182,2.146,0.271,3.166,0.271c4.43,0,7.832-1.789,10.848-3.723c0.238-0.153,0.471-0.314,0.707-0.473   c-0.014,2.404,0.406,5.151,1.904,7.485c1.623,2.533,4.277,4.126,7.672,4.605c0.119,0.017,0.238,0.024,0.354,0.024   c1.232,0,2.309-0.906,2.486-2.161C69.674,87.309,68.717,86.037,67.344,85.843z M53.646,74.971   c-4.285,2.746-6.721,3.343-10.49,2.724c-3.721-0.607-5.879-2.303-9.094-5.019c-3.895-3.286-9.088-8.721-11.719-15.948   c-1.615-4.445-2.695-9.338-3.301-14.956c-0.354-3.269-0.496-6.602-0.428-9.906c0.09-4.144,1.258-8.236,3.471-12.161   c2.832-5.013,6.844-8.859,11.924-11.43c3.654-1.849,7.555-2.786,11.594-2.786c0.291,0,0.582,0.005,0.875,0.015   c4.455,0.145,8.703,1.43,12.623,3.821c3.885,2.369,7.072,5.528,9.475,9.389c2.516,4.043,3.898,8.349,4.111,12.798   c0.021,0.436,0.012,0.868,0.006,1.301c-0.006,0.344-0.012,0.687-0.008,0.997c-0.014,8.771-1.402,16.478-4.242,23.562   C65.619,64.415,60.363,70.666,53.646,74.971z"/>
                        <path d="M62.539,58.896c0.982-0.981,0.982-2.572,0-3.554L49.201,42.005l13.338-13.338c0.982-0.981,0.982-2.572,0-3.553   c-0.98-0.981-2.572-0.981-3.553,0L45.648,38.453L32.311,25.115c-0.98-0.981-2.572-0.981-3.553,0c-0.98,0.981-0.98,2.572,0,3.553   l13.338,13.338L28.758,55.343c-0.98,0.981-0.98,2.572,0,3.554c0.49,0.49,1.135,0.735,1.777,0.735s1.285-0.245,1.775-0.735   l13.338-13.338l13.338,13.338c0.49,0.49,1.135,0.735,1.777,0.735S62.049,59.387,62.539,58.896z"/>
                      </g>
                    </svg>
                    <div className="scan-bar"></div>
                  </div>
                </Grid>
               </Grid>
             </CardContent>
         </Card>
        </Grid>
    </Grid>  
 </Container>

  )
};

export default VerifyFace;